-- DATABASE
-- create database sisima;

-- TABLE: AKUN
-- role:
-- 1 = root
-- 2 = admin
-- 3 = guru
-- 4 = siswa / walimurid
create table akun (
    id serial primary key,
    public_id char(26) unique not null,
    email varchar(255) unique not null,
    password varchar(255) not null,
    role smallint,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp
);

create table refresh_token (
    id serial primary key,
    owner_public_id char(26) not null,
    token_hash varchar(255) not null,
    expires_at timestamp not null,
    revoked boolean default false,
    created_at timestamp default now(),

    foreign key (owner_public_id) references akun(public_id)
);

-- TABLE: STORAGE
-- security only can: PUBL, AUTH, ADMN, OWNR
-- create type enum_file_type as enum ('photo', 'sound', 'video', 'pdf', 'spreadsheet', 'docx', 'other');
create table storage (
    id serial primary key,
    public_id char(26) not null unique,
    title varchar(50),
    type int,
    access int[],
    path varchar(255),
    owner_id char(26),

    foreign key (owner_id) references akun(public_id) on delete cascade
);

-- TABLE: GURU
-- create type enum_jenis_kelamin as enum ('Laki-laki', 'Perempuan');
create table guru (
    id serial primary key,
    public_id char(26) not null unique,
    nik bigint unique,
    nip bigint unique,
    npwp bigint unique,
    nama varchar(255),
    gelar_depan varchar(20),
    gelar_belakang varchar(20),
    jenis_kelamin boolean,
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    masuk smallint,
    foto int,
    file_ktp int,
    file_npwp int,
    akun_id int not null,

    foreign key (foto) references storage(id) on delete set null,
    foreign key (file_ktp) references storage(id) on delete set null,
    foreign key (file_npwp) references storage(id) on delete set null,
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: PSB
create table psb (
    id serial primary key,
    public_id char(26) unique not null,
    mulai date not null,
    selesai date not null,
    created_at timestamp not null default now()
);

-- TABLE: IDENTITAS
create type enum_identitas_status_psb as enum ('Lulus', 'Tidak Lulus');
create table identitas (
    id serial primary key,
    public_id char(26) unique not null,
    nama varchar(255),
    panggilan varchar(30),
    jenis_kelamin enum_jenis_kelamin,
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    status_psb enum_identitas_status_psb,
    foto int,
    psb_id int not null,
    akun_id int not null,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp,

    foreign key (foto) references file(id) on delete set null,
    foreign key (psb_id) references psb(id),
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: ORTU
create table ortu (
    id serial primary key,
    public_id char(26) unique not null,

    nama_ayah varchar(255),
    panggilan_ayah varchar(30),
    penghasilan_semester_ayah int,
    nik_ayah bigint,
    ktp_ayah int,

    nama_ibu varchar(255),
    panggilan_ibu varchar(30),
    penghasilan_semester_ibu int,
    nik_ibu bigint,
    ktp_ibu int,

    pengeluaran_semester int,
    alamat varchar(255),
    identitas_id int not null,

    foreign key (ktp_ayah) references file(id) on delete set null,
    foreign key (ktp_ibu) references file(id) on delete set null,
    foreign key (identitas_id) references identitas(id) on delete set null
);

-- TABLE: 
create table xx (
    id serial primary key,
    public_id char(26) unique not null,
    
);
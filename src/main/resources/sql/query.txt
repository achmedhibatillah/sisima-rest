-- DATABASE
-- create database sisima;

-- TABLE: AKUN
-- role:
-- 0 = root
-- 1 = admin
-- 2 = guru
-- 3 = siswa / walimurid
create table akun (
    id serial primary key,
    public_id char(26) unique not null,
    email varchar(255) unique not null,
    password varchar(255) not null,
    role int,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp
);

-- TABLE: FILE
-- file 'pht', 'snd', 'vdo', 'pdf', 'spd', 'dox', 'oth'
-- security ort, oad, ous, sau, pub
create table file (
    id serial primary key,
    public_id char(26) not null unique,
    type char(3),
    security char(3),
    path varchar(255)
);

-- TABLE: GURU
create table guru (
    id serial primary key,
    public_id char(26) not null unique,
    nik bigint unique,
    nip bigint unique,
    npwp bigint unique,
    nama varchar(255),
    gelar_depan varchar(20),
    gelar_belakang varchar(20),
    jenis_kelamin int,
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    masuk date,
    foto int,
    file_ktp int,
    file_npwp int,
    akun_id int not null,

    foreign key (foto) references file(id) on delete set null,
    foreign key (file_ktp) references file(id) on delete set null,
    foreign key (file_npwp) references file(id) on delete set null,
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: PSB
create table psb (
    id serial primary key,
    public_id char(26) unique not null,
    mulai date not null,
    selesai date not null,
    created_at timestamp not null default now()
);

-- TABLE: IDENTITAS
create table identitas (
    id serial primary key,
    public_id char(26) unique not null,
    nama varchar(255),
    panggilan varchar(30),
    jenis_kelamin int,
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    status_psb int,
    foto int,
    psb_id int not null,
    akun_id int not null,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp,

    foreign key (foto) references file(id) on delete set null,
    foreign key (psb_id) references psb(id),
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: ORTU
create table ortu (
    id serial primary key,
    public_id char(26) unique not null,

    nama_ayah varchar(255),
    panggilan_ayah varchar(30),
    penghasilan_semester_ayah int,
    nik_ayah bigint,
    ktp_ayah int,

    nama_ibu varchar(255),
    panggilan_ibu varchar(30),
    penghasilan_semester_ibu int,
    nik_ibu bigint,
    ktp_ibu int,

    pengeluaran_semester int,
    alamat varchar(255),
    identitas_id int not null,

    foreign key (ktp_ayah) references file(id) on delete set null,
    foreign key (ktp_ibu) references file(id) on delete set null,
    foreign key (identitas_id) references identitas(id) on delete set null
);

-- TABLE: 
create table xx (
    id serial primary key,
    public_id char(26) unique not null,
    
);
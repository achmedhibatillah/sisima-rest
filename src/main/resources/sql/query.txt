-- DATABASE
-- create database sisima;

-- TABLE: AKUN
create type enum_akun_role as enum ('root', 'admin', 'guru', 'walimurid');
create table akun (
    id serial primary key,
    public_id char(26) not null unique,
    email varchar(255) not null,
    password varchar(255) not null,
    role enum_akun_role,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp
);

-- TABLE: FILE
-- security only can: PUBL, AUTH, ADMN, OWNR
create type enum_file_type as enum ('photo', 'sound', 'video', 'pdf', 'spreadsheet', 'docx', 'other');
create table file (
    id serial primary key,
    public_id char(26) not null unique,
    type enum_file_type,
    security char(4) default 'ADMN',
    path varchar(255)
);

-- TABLE: GURU
create type enum_jenis_kelamin as enum ('Laki-laki', 'Perempuan');
create table guru (
    id serial primary key,
    public_id char(26) not null unique,
    nik bigint unique,
    nip bigint unique,
    npwp bigint unique,
    nama varchar(255),
    gelar_depan varchar(20),
    gelar_belakang varchar(20),
    jenis_kelamin enum_jenis_kelamin default 'Laki-laki',
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    masuk date,
    foto int,
    file_ktp int,
    file_npwp int,
    akun_id int not null,

    foreign key (foto) references file(id) on delete set null,
    foreign key (file_ktp) references file(id) on delete set null,
    foreign key (file_npwp) references file(id) on delete set null,
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: PSB
create table psb (
    id serial primary key,
    public_id char(26) unique not null,
    mulai date not null,
    selesai date not null,
    created_at timestamp not null default now()
);

-- TABLE: IDENTITAS
create type enum_identitas_status_psb as enum ('Lulus', 'Tidak Lulus');
create table identitas (
    id serial primary key,
    public_id char(26) unique not null,
    nama varchar(255),
    panggilan varchar(30),
    jenis_kelamin enum_jenis_kelamin,
    tempat_lahir varchar(30),
    tanggal_lahir date,
    alamat varchar(255),
    status_psb enum_identitas_status_psb,
    foto int,
    psb_id int not null,
    akun_id int not null,
    created_at timestamp not null default now(),
    updated_at timestamp not null default now(),
    deleted_at timestamp,

    foreign key (foto) references file(id) on delete set null,
    foreign key (psb_id) references psb(id),
    foreign key (akun_id) references akun(id) on delete cascade
);

-- TABLE: ORTU
create table ortu (
    id serial primary key,
    public_id char(26) unique not null,

    nama_ayah varchar(255),
    panggilan_ayah varchar(30),
    penghasilan_semester_ayah int,
    nik_ayah bigint,
    ktp_ayah int,

    nama_ibu varchar(255),
    panggilan_ibu varchar(30),
    penghasilan_semester_ibu int,
    nik_ibu bigint,
    ktp_ibu int,

    pengeluaran_semester int,
    alamat varchar(255),
    identitas_id int not null,

    foreign key (ktp_ayah) references file(id) on delete set null,
    foreign key (ktp_ibu) references file(id) on delete set null,
    foreign key (identitas_id) references identitas(id) on delete set null
);